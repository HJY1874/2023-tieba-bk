# 数据库设计文档

## E-R图（实体关系图）

### 实体定义

#### 1. User（用户）
- **主键**: id
- **属性**: username, email, password, date_joined, last_login
- **关系**: 
  - 一对多: Article（作者）
  - 一对多: Comment（评论者）
  - 一对多: Like（点赞用户）

#### 2. Category（分类）
- **主键**: id
- **属性**: name, description, created_at, updated_at
- **关系**: 
  - 一对多: Article（分类）

#### 3. Article（词条）
- **主键**: id
- **属性**: title, slug, content, summary, status, view_count, like_count, created_at, updated_at, published_at
- **外键**: 
  - author_id → User.id
  - category_id → Category.id
- **关系**: 
  - 多对一: User（作者）
  - 多对一: Category（分类）
  - 一对多: Comment（评论）
  - 一对多: Like（点赞）
  - 一对多: ArticleImage（图片）
  - 多对多: Tag（标签）

#### 4. Comment（评论）
- **主键**: id
- **属性**: content, created_at, updated_at, is_active
- **外键**: 
  - article_id → Article.id
  - author_id → User.id
- **关系**: 
  - 多对一: Article（所属词条）
  - 多对一: User（评论者）

#### 5. Like（点赞）
- **主键**: id
- **属性**: created_at
- **外键**: 
  - article_id → Article.id
  - user_id → User.id
- **关系**: 
  - 多对一: Article（所属词条）
  - 多对一: User（点赞用户）

#### 6. Tag（标签）
- **主键**: id
- **属性**: name, created_at
- **关系**: 
  - 多对多: Article（关联词条）

#### 7. ArticleImage（词条图片）
- **主键**: id
- **属性**: image, caption, uploaded_at
- **外键**: 
  - article_id → Article.id
- **关系**: 
  - 多对一: Article（所属词条）

### 关系描述

```
User (1) -----< Article (N)        # 一个用户可以创建多个词条
Category (1) -----< Article (N)    # 一个分类可以包含多个词条
Article (1) -----< Comment (N)      # 一个词条可以有多个评论
Article (1) -----< Like (N)        # 一个词条可以有多个点赞
Article (1) -----< ArticleImage (N) # 一个词条可以有多个图片
User (1) -----< Comment (N)        # 一个用户可以发表多个评论
User (1) -----< Like (N)           # 一个用户可以对多个词条点赞
Article (N) ----< Tag (N)          # 多对多关系：一个词条可以有多个标签，一个标签可以关联多个词条
```

## 数据表结构

### auth_user（用户表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| username | Varchar(150) | 用户名 | UNIQUE, NOT NULL |
| email | Varchar(254) | 邮箱 | |
| password | Varchar(128) | 密码 | NOT NULL |
| date_joined | DateTime | 注册时间 | NOT NULL |
| last_login | DateTime | 最后登录时间 | |

### baike_app_category（分类表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| name | Varchar(100) | 分类名称 | NOT NULL |
| description | Text | 分类描述 | |
| created_at | DateTime | 创建时间 | NOT NULL |
| updated_at | DateTime | 更新时间 | NOT NULL |

### baike_app_article（词条表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| title | Varchar(200) | 词条标题 | NOT NULL |
| slug | Varchar(200) | URL标识 | UNIQUE, NOT NULL |
| content | Text | 词条内容 | NOT NULL |
| summary | Varchar(500) | 摘要 | |
| author_id | Integer | 作者ID | FOREIGN KEY (auth_user.id) |
| category_id | Integer | 分类ID | FOREIGN KEY (baike_app_category.id) |
| status | Varchar(10) | 状态 | NOT NULL, DEFAULT 'draft' |
| view_count | Integer | 浏览次数 | DEFAULT 0 |
| like_count | Integer | 点赞数 | DEFAULT 0 |
| created_at | DateTime | 创建时间 | NOT NULL |
| updated_at | DateTime | 更新时间 | NOT NULL |
| published_at | DateTime | 发布时间 | |

### baike_app_comment（评论表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| article_id | Integer | 词条ID | FOREIGN KEY (baike_app_article.id) |
| author_id | Integer | 作者ID | FOREIGN KEY (auth_user.id) |
| content | Text | 评论内容 | NOT NULL |
| created_at | DateTime | 评论时间 | NOT NULL |
| updated_at | DateTime | 更新时间 | NOT NULL |
| is_active | Boolean | 是否有效 | DEFAULT True |

### baike_app_like（点赞表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| article_id | Integer | 词条ID | FOREIGN KEY (baike_app_article.id) |
| user_id | Integer | 用户ID | FOREIGN KEY (auth_user.id) |
| created_at | DateTime | 点赞时间 | NOT NULL |

### baike_app_tag（标签表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| name | Varchar(50) | 标签名称 | UNIQUE, NOT NULL |
| created_at | DateTime | 创建时间 | NOT NULL |

### baike_app_article_tags（词条标签关联表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| article_id | Integer | 词条ID | FOREIGN KEY (baike_app_article.id) |
| tag_id | Integer | 标签ID | FOREIGN KEY (baike_app_tag.id) |

### baike_app_articleimage（词条图片表）
| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | Integer | 主键 | PRIMARY KEY, AUTO_INCREMENT |
| article_id | Integer | 词条ID | FOREIGN KEY (baike_app_article.id) |
| image | Varchar(100) | 图片路径 | NOT NULL |
| caption | Varchar(200) | 图片说明 | |
| uploaded_at | DateTime | 上传时间 | NOT NULL |

## 索引设计

### 词条表索引
- **主键索引**: id (PRIMARY)
- **唯一索引**: slug (UNIQUE)
- **普通索引**: 
  - created_at (用于按时间排序)
  - status (用于状态筛选)
  - category_id (用于分类筛选)
  - author_id (用于作者筛选)

### 评论表索引
- **主键索引**: id (PRIMARY)
- **普通索引**: 
  - article_id (用于词条评论查询)
  - author_id (用于用户评论查询)
  - created_at (用于时间排序)

### 点赞表索引
- **主键索引**: id (PRIMARY)
- **唯一索引**: (article_id, user_id) (防止重复点赞)
- **普通索引**: 
  - article_id (用于词条点赞统计)
  - user_id (用于用户点赞查询)

## 数据库设计原则

### 1. 规范化设计
- 符合第三范式（3NF）
- 减少数据冗余
- 确保数据一致性

### 2. 性能考虑
- 合理设计索引
- 避免过度规范化
- 考虑查询性能

### 3. 扩展性
- 预留扩展字段
- 支持未来功能扩展
- 考虑数据量增长

### 4. 安全性
- 外键约束
- 数据完整性
- 权限控制

## 数据字典

### 状态字段枚举值

#### 词条状态（article.status）
- **draft**: 草稿
- **published**: 已发布
- **archived**: 已归档

### 字段长度限制
- **用户名**: 150字符
- **邮箱**: 254字符
- **词条标题**: 200字符
- **URL标识**: 200字符
- **摘要**: 500字符
- **标签名称**: 50字符
- **图片说明**: 200字符

## 数据关系示例

### 示例数据

#### 用户数据
```sql
INSERT INTO auth_user (username, email, password) VALUES 
('admin', 'admin@example.com', 'pbkdf2_sha256$...'),
('user1', 'user1@example.com', 'pbkdf2_sha256$...');
```

#### 分类数据
```sql
INSERT INTO baike_app_category (name, description) VALUES 
('编程语言', '各种编程语言的介绍'),
('数据结构', '数据结构相关知识'),
('算法', '算法设计与分析');
```

#### 词条数据
```sql
INSERT INTO baike_app_article (title, slug, content, author_id, category_id, status) VALUES 
('Python', 'python', 'Python是一种高级编程语言...', 1, 1, 'published'),
('数组', 'array', '数组是一种线性数据结构...', 2, 2, 'published');
```

这个数据库设计支持了百科系统的所有核心功能，具有良好的扩展性和性能表现。